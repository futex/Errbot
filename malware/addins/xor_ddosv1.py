import r2pipe
import sys
import codecs

def strxor(a, b):
    return "".join([chr(ord(x) ^ ord(y)) for (x, y) in zip(a, b*100)])


def get_config(malwareFile):
	r2 = r2pipe.open(malwareFile)
	r2.cmd("zn xorddos")
	r2.cmd("zb sym.decrypt_remotestr 5589..81..........8d..........b8........89......c7..............89....e8........c7............c7..............c7..............c7............e8........c7..............c7............e8........c7............eb..c7............8d..........89..b8........89......c7..............89....e8........eb..8b....8b....0fb6..88............83......83......8b....0fb6..3c..74..8b....0fb6..84..75..0fb6..........84..74..8d..........89....e8........8b....0fb6..84..74..83......8b....0fb6..84..0f85........c9c3")
	r2.cmd("zb sym.encrypt_code 5589..83....c7............8b....89....c7............eb..8b....0fb6..8b....89..c1....f7....89..0fb6..........89..31..8b....88..83......83......8b....3b....7c..8b....c9c3")
	r2.cmd("zn-")
	r2.cmd(".z/")
	r2.cmd("s sign.xorddos.b.sym.encrypt_code")
	xorkey_offset = str(r2.cmdj("aoj 1 @i:15")[0]["ptr"])
	xorkey_length = r2.cmd("fl @ "+ xorkey_offset)

	xorkey=codecs.decode(r2.cmd("p8 " + xorkey_length +" @ " + xorkey_offset), "hex_codec").decode()

	r2.cmd("s sign.xorddos.b.sym.decrypt_remotestr")
	config_offset = str(r2.cmdj("aoj 1 @i:11")[0]["val"])
	config_size = r2.cmd("? str.STATIC - " + config_offset)
	
	remotestr=codecs.decode(r2.cmd("p8" + config_size +"  @ " +config_offset ), "hex_codec").decode()
	
	return ' '.join(strxor(remotestr, xorkey).split("|"))